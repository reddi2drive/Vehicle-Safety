 <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- =========================================================
       NOTE (R2D): Page identity
       - Change <title>Vehicle Safety</title>
  <meta name="description" content="Reddi2Drive knowledge test Vehicle Safety (UK). Duplicate this file to build new topic tests." />
  

<!-- NOTE (R2D): Home Screen icon (Add to Home Screen)
     iOS uses apple-touch-icon. Android uses manifest icons.
     Add these lines and upload the PNGs to your site:
     <link rel="apple-touch-icon" sizes="180x180" href="icons/reddi2drive-180.png">
     <link rel="manifest" href="manifest.json">
-->
<style>

    /* =========================================================
       STYLES (edit colours, spacing, logo size, etc.)
       ---------------------------------------------------------
       - Most layout is in .card, .btn, .option, and the header.
       - Image sizing rules: .q-image, .q-image.large, .q-image.xlarge
       ========================================================= */


    .q-image{
  display:none;
  width:100%;
  max-width:275px;           /* default image size (desktop) */
  height:auto;
  margin:14px auto 8px;
  border-radius:12px;
}

/* Larger image flags (per-question) */
.q-image.large{ max-width:520px; }
.q-image.xlarge{ max-width:850px; }

/* Mobile / iPad */
@media (max-width: 820px){
  .q-image{ max-width:250px; }
  .q-image.large{ max-width:500px; }
  .q-image.xlarge{ max-width:900px; }
}
@media (max-width: 820px){
    .q-image.xlarge{max-width:750px; }
   }
/* Layout: keep existing button styling, just push Quit to far right */
.r2d-nav-row{
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  margin-top: 6px;   /* ← drop the buttons down a bit */
}
.r2d-spacer{ flex:1; }


    


    /* =========================================================
       NOTE (R2D): Theme variables (quick way to make each test look unique)
       - Change --bg, --card, --accent, --good, --bad to alter colour scheme.
       - Change --max for layout width.
       ========================================================= */
    :root{
      --bg:#0b1220; --card:#121a2b; --text:#eef3ff; --muted:#9fb0cc;
      --accent:#4aa3ff; --good:#2bd576; --bad:#ff4d4d; --border:rgba(255,255,255,.10);
      --shadow:0 12px 30px rgba(0,0,0,.35); --r:16px; --max:820px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
      background:
        radial-gradient(1200px 800px at 20% 0%, rgba(74,163,255,.18), transparent 55%),
        radial-gradient(1200px 800px at 80% 0%, rgba(43,213,118,.10), transparent 55%),
        var(--bg);
    }
    header{max-width:var(--max); margin:0 auto; padding:22px 16px 8px}
    h1{margin:0; font-size:20px; letter-spacing:.2px}
    main{max-width:var(--max); margin:0 auto; padding:8px 16px 28px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.03), transparent 40%), var(--card);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      border-radius:var(--r);
      padding:18px;
      margin:12px 0;
    }
    .row{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .pill{border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-size:12px; color:var(--muted)}
    .muted{color:var(--muted)}
    .big{font-size:28px; margin:0}
    .btn{
      border-radius:14px; border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text); padding:11px 14px; cursor:pointer; font-weight:700;
    }
    .btn.primary{
      background:linear-gradient(90deg, rgba(74,163,255,.95), rgba(74,163,255,.55));
      border-color:rgba(74,163,255,.55); color:#07101d;
    }
    .btn.ghost{background:transparent}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .tag{display:inline-block; font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); color:var(--muted)}
    .progress{height:10px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; border:1px solid var(--border); margin-top:12px}
    .progress > div{height:100%; width:0%; background:linear-gradient(90deg, var(--accent), rgba(74,163,255,.55)); transition:width .25s ease}
    .qTitle{margin:10px 0 12px; font-size:18px}
    .answers{display:grid; gap:10px; margin-top:10px}
    .option{
      text-align:left; width:100%;
      padding:12px 12px; border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      color:var(--text); cursor:pointer;
      transition:transform .05s ease, background .15s ease, border-color .15s ease;
    }
    .option:hover{background:rgba(255,255,255,.06)}
    .option:active{transform:scale(.995)}
    .option.selected{border-color:rgba(74,163,255,.65); background:rgba(74,163,255,.12)}
    .option[disabled]{cursor:not-allowed; opacity:.95}
    .feedback{margin-top:12px; padding:12px; border-radius:14px; border:1px solid var(--border); background:rgba(255,255,255,.03)}
    .feedback.good{border-color:rgba(43,213,118,.35); background:rgba(43,213,118,.08)}
    .feedback.bad{border-color:rgba(255,77,77,.35); background:rgba(255,77,77,.08)}
    .feedback .title{display:flex; justify-content:space-between; gap:10px; align-items:center; font-weight:800; margin-bottom:6px}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    .small{font-size:12px; color:var(--muted)}
    .kpi{display:flex; gap:12px; flex-wrap:wrap; margin-top:10px}
    .box{flex:1 1 160px; border:1px solid var(--border); background:rgba(255,255,255,.03); border-radius:14px; padding:12px}
    .box .n{font-size:22px; font-weight:900; margin:0}
    .box .l{margin:2px 0 0; color:var(--muted); font-size:12px}
.imgwrap{
  margin:10px auto;
  display:flex;
  justify-content:center;
}
.hint{border-left:3px solid rgba(255,204,102,.7); padding-left:16px; margin-top:10px; color:var(--muted); font-size:13px}
    a{color:var(--accent)}
    .reviewItem{border-top:1px solid var(--border); padding-top:12px; margin-top:12px}
/* --- Review ticks / crosses --- */
#reviewScreen .reviewItem{ position:relative; }
#reviewScreen .reviewItem .result{
  position:absolute;
  top:12px;
  right:12px;
  font-size:22px;
  font-weight:900;
  line-height:1;
  white-space:nowrap;
}
#reviewScreen .reviewItem .result.ok{ color:var(--good); }
#reviewScreen .reviewItem .result.bad{ color:var(--bad); }
#reviewScreen .reviewItem .row{ padding-right:48px; }

    .zoomOverlay{
      position:fixed; inset:0; background:rgba(0,0,0,.75);
      display:none; align-items:center; justify-content:center; padding:16px; z-index:9999;
    }
    .zoomOverlay img{
      max-width:min(980px, 96vw);
      max-height:90vh;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.18);
    }
    .brand{
  margin:0;
  font-size:20px;
  letter-spacing:.2px;
  display:flex;
  align-items:center;
  gap:10px;
}
.brandLogo{
  height:60px;
  width:60px;
  border-radius:60%;
  object-fit:cover;
  display:block;
}


/* --- Scroll + pull-to-refresh protection (iPhone + iPad) --- */
html, body{
  height:100%;
  margin:0;
  overflow:hidden;           /* page itself doesn't scroll */
}
body{
  position:fixed;            /* prevents iPad pull-to-refresh bounce */
  width:100%;
}
#appScroll{
  height: 100%;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: none;
}

/* --- Keep the action buttons reachable when an image is shown --- */
#quizScreen{
  padding-bottom:84px;       /* space for the sticky nav row */
}
.r2d-nav-row{
  position:sticky;
  bottom:0;
  z-index:50;
  background:linear-gradient(180deg, rgba(18,26,43,.75), rgba(18,26,43,1));
  backdrop-filter:saturate(120%) blur(6px);
  border-top:1px solid var(--border);
  padding:10px 0 6px;
  margin-top:12px;
}
  .r2d-tagline{
  width:100%;
  text-align:right;          /* desktop/tablet wide */
  margin:-15px 0 0 16px;   /* closer to title, pushed further right */
  font-weight:800;
  letter-spacing:.08em;
  font-size:.85rem;
  position:relative;
  left:16px;
}
@media (max-width: 1024px){
  /* iPad/iPhone: tagline sits UNDER the title */
  .row.header-row{
    flex-direction:column;
    align-items:flex-start;
    gap:6px;
  }
  .r2d-tagline{
    text-align:center;
    margin:-19px 0 0 12px;  /* closer + pushed further right on small screens */
    left:12px;
  }
}

.r2d-word{ text-transform:none; }
.r2d-word.learn{ color:#e53935; }
.r2d-word.drive{
  color:#111;                 /* your requested “black” */
  text-shadow:0 0 2px rgba(255,255,255,.65); /* keeps it readable on dark header */
}
.r2d-word.pass{  color:#fff; }

.two{ color:#9aa0a6; }
.dot{ margin:0 1px; color:rgba(255,255,255,.35); }

/* (Remove the old .question img sizing rules — q-image handles it) */
.review-image{display:block; margin:10px auto;}

/* --- Quiz UI tweaks --- */
/* Hide the category pill on the quiz screen */
#quizScreen #catTag{ display:none !important; }

/* Submit/Next button colour change */
.btn.next-state{
  background:linear-gradient(90deg, rgba(43,213,118,.95), rgba(43,213,118,.55));
  border-color:rgba(43,213,118,.55);
  color:#07101d;
}



/* --- Quit confirmation modal --- */
.quit-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10000;
  backdrop-filter: blur(3px);
}

.quit-box{
  background:var(--card);
  border:1px solid var(--border);
  box-shadow:var(--shadow);
  border-radius:18px;
  padding:22px 20px;
  width:min(320px, 90vw);
  text-align:center;
}

.quit-title{
  font-size:18px;
  font-weight:800;
  margin:0 0 6px;
}

.quit-actions{
  display:flex;
  gap:12px;
  justify-content:center;
  margin-top:16px;
}


/* --- Review Last Attempt button (Start screen only) --- */
#reviewLastWrap{
  position:absolute;
  bottom:16px;
  left:50%;
  transform:translateX(-50%);
  display:none;
  text-align:center;
  z-index:20;
}
#reviewLastBtn{
  padding:8px 12px;
  font-weight:800;
}
#reviewLastMeta{
  font-size:11px;
  color:var(--muted);
  margin-top:4px;
}

</style>
</head>
<body>
  <div id="appScroll">
  <header>
    <div class="row header-row">

      <!-- =========================================================
           NOTE (R2D): Branding
           - Change the logo file name in src="..." (keep image in same folder or update path).
           - Change the on-page title in <span id="testTitleText">Vehicle Safety</span>
           - Tagline text is below (can be edited or removed).
           ========================================================= -->
      <h1 class="brand">
        <!-- NOTE (R2D): Logo file name/path goes here -->
        <a href="https://reddi2drive.co.uk/practice/" class="r2d-logo-link">
  <img src="reddi2drivelogo.png" alt="Reddi2Drive" class="brandLogo">
</a>
        <!-- NOTE (R2D): Change this visible test title text (or let JS set it from TEST_TITLE). -->
        <span id="testTitleText">Vehicle Safety</span>
      </h1>

      <div class="r2d-tagline" aria-label="Reddi2Learn Reddi2Drive Reddi2Pass">
        <span class="r2d-word learn">Reddi<span class="two">2</span>Learn</span>
        <span class="dot">|</span>
        <span class="r2d-word drive">Reddi<span class="two">2</span>Drive</span>
        <span class="dot">|</span>
        <span class="r2d-word pass">Reddi<span class="two">2</span>Pass</span>
      </div>
    </div>
  </header>

  <main>
    <!-- =========================================================
         START SCREEN
         - Update the intro text here for each test if you want.
         - Buttons: Start / Shuffle / Reset Best
         ========================================================= -->

    <section class="card" id="startScreen" style="position:relative; padding-bottom:90px">


<div id="reviewLastWrap">
  <button class="btn ghost" id="reviewLastBtn" type="button">Review Last Attempt</button>
  <div id="reviewLastMeta"></div>
</div>


      <!-- NOTE (R2D): Start screen intro text (edit per topic) -->
      <p class="big">Test Your Knowledge</p>
      <p class="muted">No hints during the test — you’ll get your score and full review at the end.</p>

      
      <!-- NOTE (R2D): KPI labels (these are the two boxes on the start screen) -->
<div class="kpi">
  <div class="box">
    <p class="n" id="lastScore">—</p>
    <p class="l">Last attempt score</p>
  </div>
  <div class="box">
    <p class="n" id="bestScore">—</p>
    <p class="l">Best score achieved</p>
  </div>
</div>

    

      <!-- NOTE (R2D): Start screen buttons (text + visibility can be changed here) -->
      <div class="actions">
        <button class="btn primary" id="startBtn">Start test</button>
        
        <!-- Question count selector (inline) -->
        <div class="pill" id="qsWrapper" style="display:flex; align-items:center; gap:6px; padding:6px 10px">
          <span class="muted" style="font-size:12px; font-weight:800;">Questions</span>
          <!-- ✅ EDIT ME: Question-count dropdown options
               Change the numbers/options here for each quiz (e.g. 10/25/50/Full).
               Keep value="full" for the Full option (the script uses it). -->
          <select id="qsSelect" class="btn ghost" style="padding:6px 8px; font-weight:800; min-width:86px">
            <option value="20">20</option>
            <option value="40">40</option>
            <option value="60">60</option>
            <option value="full">Full</option>
          </select>
          <span class="muted" id="qsHint" style="font-size:12px;"></span>
        </div>
<button class="btn" id="resetBestBtn" title="Clears your saved best score">Reset best</button>
      </div>

      <p class="small" style="margin-top:10px">
        UK guidance: always follow signs/markings and local rules for the topic you’re testing.
      </p>
    </section>

    <!-- =========================================================
         QUIZ SCREEN
         - Shows question, optional image, answer options.
         - Submit turns into Next after submitting.
         ========================================================= -->


    <!-- =========================================================
         NOTE (R2D): Quiz screen
         - Counter format is in #counter (e.g., 1 / 10).
         - Submit button behaviour is controlled in the script (submit -> next).
         - The Quit modal copy is lower down.
         ========================================================= -->
    <section class="card" id="quizScreen" style="display:none">
      <div class="row">
        <div>
          <span class="tag" id="catTag">Category</span>
          <span class="muted" id="counter">1 / 10</span>
        </div>
        <div class="muted" id="scoreMini">Score: 0</div>
      </div>

      <div class="progress"><div id="bar"></div></div>

      <h2 class="qTitle" id="qText">…</h2>

     <img id="qImage" class="q-image" src="" alt="Question image">
      <p class="small" id="imgHint" style="display:none; margin:8px 2px 0">Tap the image to zoom.</p>

      <div class="answers" id="answers"></div>

      <div class="feedback" id="feedback" style="display:none"></div>

 <div class="nav-buttons r2d-nav-row">
  <button class="btn" id="backBtn">Back</button>
  <button class="btn primary" id="submitBtn">Submit</button>
    <span class="r2d-spacer" aria-hidden="true"></span>
  <button class="btn" id="quitBtn">Quit</button>
</div>
    </section>

    <!-- =========================================================
         RESULTS SCREEN
         - Shows score, percentage, time.
         - Buttons: Try again / Review
         ========================================================= -->


    <!-- NOTE (R2D): Results screen text (edit wording per test) -->
    <section class="card" id="resultsScreen" style="display:none">
      <p class="big" id="resultTitle">Results</p>
      <p class="muted" id="resultSub">…</p>

      <div class="kpi">
        <div class="box">
          <p class="n" id="finalScore">0 / 10</p>
          <p class="l">Score</p>
        </div>
        <div class="box">
          <p class="n" id="finalPercent">0%</p>
          <p class="l">Percentage</p>
        </div>
        <div class="box">
          <p class="n" id="finalTime">—</p>
          <p class="l">Time</p>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="retryBtn">Try again</button>
        <button class="btn" id="reviewBtn">Review</button>
      </div>

      <p class="small" style="margin-top:10px">
        Tip: Add to Home Screen (Safari → Share → Add to Home Screen).
      </p>
    </section>

    <!-- =========================================================
         REVIEW SCREEN
         - Shows each question, your answer vs correct, explanation.
         - Filter dropdown: All / Incorrect only
         ========================================================= -->


    <!-- NOTE (R2D): Review screen + filter labels (edit wording here) -->
    <section class="card" id="reviewScreen" style="display:none">
      <p class="big">Review</p>
      <p class="muted">Your choice vs the correct answer, plus the explanation.</p>
      <div class="row" style="margin:12px 0 6px">
        <div class="pill" style="display:flex; align-items:center; gap:10px">
          <label for="reviewFilter" class="muted" style="font-size:12px; margin:0">Show:</label>
          <select id="reviewFilter" class="btn" style="padding:8px 10px; font-weight:800">
            <option value="all">All questions</option>
            <option value="wrong">Incorrect only</option>
          </select>
        </div>
        <div class="muted small" id="reviewCount"></div>
      </div>
      <div id="reviewList"></div>

      <div class="actions">
        <button class="btn primary" id="backToResultsBtn">Back to results</button>
        <button class="btn" id="newAttemptBtn">New attempt</button>
      </div>
    </section>

  <!-- NOTE (R2D): Quit confirmation modal text (edit wording here) -->
  <!-- Quit confirmation modal -->
  <div id="quitConfirm" class="quit-overlay" style="display:none;">
    <div class="quit-box" role="dialog" aria-modal="true" aria-labelledby="quitTitle">
      <p class="quit-title" id="quitTitle">Are you sure?</p>
      <p class="muted">Your current progress will be lost.</p>
      <div class="quit-actions">
        <button class="btn ghost" id="quitNoBtn" type="button">No</button>
        <button class="btn primary" id="quitYesBtn" type="button">Yes, Quit</button>
      </div>
    </div>
  </div>


  <!-- NOTE (R2D): Resume attempt modal text (edit wording here) -->
  <!-- Resume Attempt Modal -->
  <div id="resumeModal" class="quit-overlay" style="display:none;">
    <div class="quit-box" role="dialog" aria-modal="true" aria-labelledby="resumeTitle">
      <p class="quit-title" id="resumeTitle">Resume attempt?</p>
      <p class="muted" id="resumeInfo">…</p>
      <div class="quit-actions">
        <button class="btn ghost" id="resumeFreshBtn" type="button">Start fresh</button>
        <button class="btn primary" id="resumeBtn" type="button">Resume</button>
      </div>
    </div>
  </div>

  </main>

  <div class="zoomOverlay" id="zoomOverlay" aria-hidden="true">
    <img id="zoomImg" alt="Zoomed question visual" />
  </div>

<script>
// =========================================================
// REDDI2DRIVE QUIZ TEMPLATE SCRIPT
// ---------------------------------------------------------
// Sections:
// 0) Test Settings (title, slug, number of questions)
// 1) Question Bank (you replace this for each new test)
// 2) State + helpers (shuffle, storage, UI switching)
// 3) Quiz engine (render, select, submit/next)
// 4) Results + review builder
// 5) iOS/iPad scroll/pull-to-refresh protection
// =========================================================

// =========================================================
// 1) QUESTION BANK (EDIT THIS FOR EACH NEW TEST)
// NOTE (R2D): How to make your question bank unique & traceable
// - Keep IDs unique (you are already using vru-0001 etc.)
// - Each question has fp: "..." (your fingerprint). Keep it, or regenerate it per question.
// - If you add images, put files next to this HTML or update the image path.

// ---------------------------------------------------------
// Each question object supports:
// - id: unique string (use a topic prefix like "tl-01", "sp-02", etc.)
// - category: used for the tag on the quiz + review (optional but recommended)
// - q: the question text
// - choices: array of answer strings (A/B/C/D etc.)
// - correct: index of the correct choice (0-based)
// - explain: explanation shown in the Review screen
// - image: filename of an image in the same folder as this HTML (optional)
// - largeImage / extraLargeImage: set true to increase image size (optional)
//
// TIP: Keep filenames consistent (e.g. "tl-q01.png") and put the images in the same GitHub folder.
// =========================================================
// =========================================================
// =========================================================
// NOTE (R2D): Make this test UNIQUE (critical)
// 1) Change TEST_TITLE and TEST_SLUG below.
//    - TEST_SLUG must be UNIQUE per test or scores/resume data will clash.
// 2) Optionally change QS_PER_ATTEMPT_DEFAULT.
// =========================================================


// =========================================================
// ✅ EDIT ME WHEN MAKING A NEW QUIZ (ONLY 3 PLACES)
// ---------------------------------------------------------
// 1) TITLE
//    - Change TEST_TITLE below (updates the on-page title + browser tab)
//    - Keep TEST_SLUG unique per quiz (so saved scores don't clash)
//
// 2) QUESTIONS
//    - Replace the QUESTION_BANK array with your new questions (same format)
//
// 3) DROPDOWN NUMBERS (start screen)
//    - Edit the <select id="qsSelect"> options in the HTML (10/25/50/Full etc.)
//      You will find it by searching for: id="qsSelect"
//
// Nothing else needs changing to publish a new quiz.
// =========================================================

// 0) TEST SETTINGS (EDIT THESE WHEN YOU COPY THIS TEMPLATE)
// =========================================================
// Keep TEST_SLUG unique per test, or scores/resume data will clash between tests.
const TEST_TITLE = "Vehicle Safety";  // ← CHANGE THIS (on-page + tab title)
const _titleEl = document.getElementById("testTitleText");
if (_titleEl) _titleEl.textContent = TEST_TITLE;
document.title = `Reddi2Drive – ${TEST_TITLE}`;
       // e.g. "Traffic Lights", "Motorways", "Signs & Markings"
const TEST_SLUG  = "Vehicle Safety";    // ← CHANGE THIS (must be unique per quiz)    // e.g. "traffic-lights", "motorways", "signs"
// Number of questions per attempt (cannot exceed QUESTION_BANK length)
const QS_PER_ATTEMPT_DEFAULT = 71;
// =========================================================


// =========================================================
// ✅ EDIT ME: QUESTION BANK
// ---------------------------------------------------------
// Replace everything inside QUESTION_BANK with your new questions.
// Keep the same object keys you already use: id, category, q, choices, correct,
// explain, image, fp
//
// Example format (keep correct as 0-3 index):
// {
//   id: "oru-0001",
//   category: "Other road users",
//   q: "Question text...",
//   choices: ["A","B","C","D"],
//   correct: 2,
//   explain: "Explanation...",
//   image: "",   // or "oru-0001.png"
//   fp: "R2D-ORU-0001-YYYYMMDD-XXXX"
// }
// =========================================================

const QUESTION_BANK = [
{
    id: "your vehicle and your safety 1",
    category: "Safety – Vehicle Emissions",
    q: "Why is an exhaust emissions test included as part of the MOT?",
    choices: [
      "To check the performance of the exhaust system",
      "To help reduce harmful pollution from vehicles",
      "To measure fuel efficiency",
      "To ensure petrol and diesel engines produce similar emissions"
    ],
    correct: 1,
    explain: "The emissions test checks that harmful gases are kept to a minimum, helping to reduce air pollution and protect the environment.",
    image: "",
    fp: "R2D-SAFETY-IMG-001-20260129"
  },
  {
    id: "your vehicle and your safety 2",
    category: "Safety – Vehicle Maintenance",
    q: "What problem is most likely if an engine is overfilled with oil?",
    choices: [
      "The clutch may fail suddenly",
      "Oil seals may be damaged and leak",
      "The air filter may become blocked",
      "The timing belt may slip"
    ],
    correct: 1,
    explain: "Too much oil increases pressure inside the engine, which can damage seals and cause oil leaks.",
    image: "",
    fp: "R2D-SAFETY-IMG-002-20260129"
  },
  {
    id: "your vehicle and your safety 3",
    category: "Safety – Seat Belts",
    q: "You’re driving children under 14 years old. Who is legally responsible for ensuring they are properly restrained?",
    choices: [
      "An adult passenger",
      "The children themselves",
      "You, the driver",
      "Their parents"
    ],
    correct: 2,
    explain: "The driver is legally responsible for ensuring children are wearing seat belts or using an approved child restraint.",
    image: "",
    fp: "R2D-SAFETY-IMG-003-20260129"
  },
  {
    id: "your vehicle and your safety 4",
    category: "Safety – Tyres and Brakes",
    q: "What fault could cause uneven or excessive tyre wear?",
    choices: [
      "A faulty gearbox",
      "A faulty braking system",
      "A faulty electrical system",
      "A faulty exhaust system"
    ],
    correct: 1,
    explain: "Brake, suspension or alignment faults can cause tyres to wear unevenly, increasing the risk of loss of control.",
    image: "",
    fp: "R2D-SAFETY-IMG-004-20260129"
  },
  {
    id: "your vehicle and your safety 5",
    category: "Safety – Eco-Safe Driving",
    q: "What is one benefit of driving smoothly?",
    choices: [
      "Shorter journey times",
      "Higher fuel consumption",
      "Lower fuel consumption",
      "Increased engine performance"
    ],
    correct: 2,
    explain: "Smooth driving reduces fuel use, wear on the vehicle, and the amount of pollution produced.",
    image: "",
    fp: "R2D-SAFETY-IMG-005-20260129"
  },
  {
    id: "your vehicle and your safety 6",
    category: "Safety – Vehicle Components",
    q: "Where is a catalytic converter fitted on a vehicle?",
    choices: [
      "In the fuel tank",
      "In the air intake system",
      "In the cooling system",
      "In the exhaust system"
    ],
    correct: 3,
    explain: "A catalytic converter is part of the exhaust system and reduces harmful gases produced by the engine.",
    image: "",
    fp: "R2D-SAFETY-IMG-006-20260129"
  },
  {
    id: "your vehicle and your safety 7",
    category: "Safety – Environmental Driving",
    q: "How can you reduce the environmental impact of your driving?",
    choices: [
      "Brake sharply when needed",
      "Use the busiest roads available",
      "Anticipate hazards early",
      "Accelerate hard to maintain momentum"
    ],
    correct: 2,
    explain: "Anticipating hazards helps you avoid harsh braking and acceleration, reducing fuel use and emissions.",
    image: "",
    fp: "R2D-SAFETY-IMG-007-20260129"
  },
  {
    id: "your vehicle and your safety 8",
    category: "Safety – Occupant Protection",
    q: "What helps reduce the risk of neck injury in a collision?",
    choices: [
      "Anti-lock brakes",
      "A collapsible steering wheel",
      "An air-sprung seat",
      "A correctly adjusted head restraint"
    ],
    correct: 3,
    explain: "A properly adjusted head restraint reduces whiplash injuries by supporting the head during a collision.",
    image: "",
    fp: "R2D-SAFETY-IMG-008-20260129"
  },
  {
    id: "your vehicle and your safety 9",
    category: "Safety – Child Passengers",
    q: "You must carry a child under 1.35 metres on a short, unexpected journey without a child seat. How should they be restrained?",
    choices: [
      "Sharing a seat belt with an adult",
      "Using an adult seat belt on the rear seat",
      "Sitting between two other children",
      "Sitting behind the passenger seat without a belt"
    ],
    correct: 1,
    explain: "In an unexpected necessity, a child may use an adult seat belt on the rear seat if no suitable child restraint is available.",
    image: "",
    fp: "R2D-SAFETY-IMG-009-20260129"
  },
  {
    id: "your vehicle and your safety 10",
    category: "Safety – Passenger Responsibility",
    q: "You’re carrying two 13-year-old children in your car. Who is responsible for ensuring they wear seat belts?",
    choices: [
      "Their parents",
      "The front-seat passenger",
      "The children",
      "You, the driver"
    ],
    correct: 3,
    explain: "The driver is legally responsible for ensuring passengers under 14 years old are correctly restrained.",
    image: "",
    fp: "R2D-SAFETY-IMG-010-20260129"
  },
  {
    id: "your vehicle and your safety 11",
    category: "Safety – Environmentally Friendly Transport",
    q: "What makes the vehicle shown environmentally friendly?",
    choices: [
      "It is powered by gravity",
      "It is powered by diesel",
      "It is powered by electricity",
      "It is powered by unleaded petrol"
    ],
    correct: 2,
    explain: "Electric trams are powered by electricity and do not produce exhaust fumes, helping to reduce pollution in busy areas.",
    image: "tram.PNG",
    fp: "R2D-SAFETY-IMG-011-20260129"
  },
  {
    id: "your vehicle and your safety 12",
    category: "Safety – Vehicle Servicing",
    q: "What is a key benefit of following the manufacturer’s service schedule?",
    choices: [
      "Lower insurance costs",
      "Reduced vehicle tax",
      "Improved vehicle reliability",
      "Shorter journey times"
    ],
    correct: 2,
    explain: "Regular servicing helps keep the vehicle reliable and reduces the risk of breakdowns caused by worn or faulty components.",
    image: "",
    fp: "R2D-SAFETY-IMG-012-20260129"
  },
  {
    id: "your vehicle and your safety 13",
    category: "Safety – Traffic Management",
    q: "Why have red routes been introduced in major cities?",
    choices: [
      "To increase speed limits",
      "To improve the flow of traffic",
      "To provide more parking spaces",
      "To allow easier loading for large vehicles"
    ],
    correct: 1,
    explain: "Red routes restrict stopping and parking to keep traffic moving and reduce congestion in busy urban areas.",
    image: "",
    fp: "R2D-SAFETY-IMG-013-20260129"
  },
  {
    id: "your vehicle and your safety 14",
    category: "Safety – Vehicle Care",
    q: "What part of the vehicle can be damaged by turning the steering wheel while the car is stationary?",
    choices: [
      "The gearbox",
      "The engine",
      "The brakes",
      "The tyres"
    ],
    correct: 3,
    explain: "Turning the wheels while stationary, known as dry steering, causes unnecessary wear to the tyres and steering components.",
    image: "",
    fp: "R2D-SAFETY-IMG-014-20260129"
  },
  {
    id: "your vehicle and your safety 15",
    category: "Safety – Vehicle Security",
    q: "What should you always do when leaving your vehicle parked and unattended?",
    choices: [
      "Park near a busy junction",
      "Park in a housing estate",
      "Lock it and remove the key",
      "Leave the left indicator on"
    ],
    correct: 2,
    explain: "Locking the vehicle and removing the key reduces the risk of theft and helps protect your insurance cover.",
    image: "",
    fp: "R2D-SAFETY-IMG-015-20260129"
  },
  {
    id: "your vehicle and your safety 16",
    category: "Safety – Emissions Control",
    q: "What is the main purpose of a catalytic converter?",
    choices: [
      "To reduce fuel consumption",
      "To reduce the risk of fire",
      "To reduce harmful exhaust gases",
      "To reduce engine wear"
    ],
    correct: 2,
    explain: "Catalytic converters reduce the amount of harmful gases produced by the engine before they exit the exhaust.",
    image: "",
    fp: "R2D-SAFETY-IMG-016-20260129"
  },
  {
    id: "your vehicle and your safety 17",
    category: "Safety – Personal Security",
    q: "Why should you try to park in a secure car park when possible?",
    choices: [
      "It makes your car easier to find",
      "It helps deter thieves",
      "It protects the car from bad weather",
      "It is always free to use"
    ],
    correct: 1,
    explain: "Secure car parks reduce the risk of theft and damage by discouraging criminal activity.",
    image: "",
    fp: "R2D-SAFETY-IMG-017-20260129"
  },
  {
    id: "your vehicle and your safety 18",
    category: "Safety – Child Seats and Airbags",
    q: "What must you do before fitting a rear-facing baby seat to a front passenger seat with an active airbag?",
    choices: [
      "Turn the seat sideways",
      "Deactivate the airbag",
      "Ask a passenger to hold the baby",
      "Use an adult seat belt"
    ],
    correct: 1,
    explain: "A rear-facing baby seat must not be used with an active frontal airbag, as deployment could cause serious injury or death.",
    image: "",
    fp: "R2D-SAFETY-IMG-018-20260129"
  },
  {
    id: "your vehicle and your safety 19",
    category: "Safety – Head Restraints",
    q: "What is the main reason for correctly adjusting your head restraint?",
    choices: [
      "To improve comfort",
      "To help prevent neck injury",
      "To help you relax while driving",
      "To maintain driving position"
    ],
    correct: 1,
    explain: "Correctly adjusted head restraints reduce the risk of neck injuries, such as whiplash, in a collision.",
    image: "",
    fp: "R2D-SAFETY-IMG-019-20260129"
  },
  {
    id: "your vehicle and your safety 20",
    category: "Safety – Warning Lights",
    q: "What should you do if the ABS warning light remains illuminated?",
    choices: [
      "Check the brake-fluid level",
      "Check the footbrake free play",
      "Check the parking brake is released",
      "Have the brakes checked as soon as possible"
    ],
    correct: 3,
    explain: "An illuminated ABS warning light indicates a fault. The braking system should be checked by a professional before continuing to drive.",
    image: "",
    fp: "R2D-SAFETY-IMG-020-20260129"
  },
  {
    id: "your vehicle and your safety 21",
    category: "Safety – Driver Assistance Systems",
    q: "What is the main purpose of advanced driver assistance systems (ADAS)?",
    choices: [
      "To reduce journey times",
      "To make driving easier",
      "To reduce environmental pollution",
      "To improve road safety"
    ],
    correct: 3,
    explain: "ADAS are designed to improve road safety by helping drivers avoid collisions, but they do not replace driver responsibility.",
    image: "",
    fp: "R2D-SAFETY-IMG-021-20260129"
  },
  {
    id: "your vehicle and your safety 22",
    category: "Safety – Traffic Calming",
    q: "What is the main purpose of road humps, chicanes and road narrowings?",
    choices: [
      "To separate lanes of traffic",
      "To increase traffic speed",
      "To allow pedestrians to cross",
      "To reduce traffic speed"
    ],
    correct: 3,
    explain: "Traffic-calming measures are used to reduce vehicle speeds, particularly in areas with pedestrians and residential housing.",
    image: "",
    fp: "R2D-SAFETY-IMG-022-20260129"
  },
  {
    id: "your vehicle and your safety 23",
    category: "Safety – Legal Requirements",
    q: "Which part of your car are you legally required to keep in good working condition?",
    choices: [
      "The gearbox",
      "The transmission",
      "The door locks",
      "The seat belts"
    ],
    correct: 3,
    explain: "Seat belts must be in good working order and are checked during the MOT. You and your passengers must wear them unless exempt.",
    image: "",
    fp: "R2D-SAFETY-IMG-023-20260129"
  },
  {
    id: "your vehicle and your safety 24",
    category: "Safety – Vehicle Load and Aerodynamics",
    q: "How will fitting a roof rack affect your car?",
    choices: [
      "There will be less wind noise",
      "The engine will use more oil",
      "The car will accelerate faster",
      "Fuel consumption will increase"
    ],
    correct: 3,
    explain: "A roof rack increases wind resistance, which causes the engine to work harder and use more fuel.",
    image: "",
    fp: "R2D-SAFETY-IMG-024-20260129"
  },
  {
    id: "your vehicle and your safety 25",
    category: "Safety – Fuel Efficiency",
    q: "When will your vehicle use more fuel?",
    choices: [
      "When its tyres are under-inflated",
      "When its tyres are of different makes",
      "When its tyres are over-inflated",
      "When its tyres are new"
    ],
    correct: 0,
    explain: "Under-inflated tyres increase rolling resistance, meaning the engine has to work harder and use more fuel.",
    image: "",
    fp: "R2D-SAFETY-IMG-025-20260129"
  },
  {
    id: "your vehicle and your safety 26",
    category: "Safety – Pedestrian Crossings",
    q: "Can you ever park on the zigzag lines of a zebra crossing?",
    choices: [
      "No, unless you stay with your car",
      "Yes, to drop off a passenger",
      "Yes, if you do not block pedestrians",
      "No, under any circumstances"
    ],
    correct: 3,
    explain: "Parking on zigzag lines is illegal as it blocks visibility for pedestrians and drivers, creating a serious safety risk.",
    image: "",
    fp: "R2D-SAFETY-IMG-026-20260129"
  },
  {
    id: "your vehicle and your safety 27",
    category: "Safety – Journey Planning",
    q: "You need to arrive on time for an appointment. How should you plan your journey?",
    choices: [
      "Allow plenty of time for the trip",
      "Plan to travel at busy times",
      "Avoid roads with the national speed limit",
      "Prevent other drivers from overtaking"
    ],
    correct: 0,
    explain: "Allowing extra time reduces stress and the temptation to take risks if delays or unexpected problems occur.",
    image: "",
    fp: "R2D-SAFETY-IMG-027-20260129"
  },
  {
    id: "your vehicle and your safety 28",
    category: "Safety – Fuel Consumption",
    q: "When is fuel consumption usually at its highest?",
    choices: [
      "When you're braking",
      "When you're coasting",
      "When you're accelerating",
      "When you're turning sharply"
    ],
    correct: 2,
    explain: "Acceleration uses the most fuel. Driving smoothly and anticipating hazards helps reduce fuel consumption.",
    image: "",
    fp: "R2D-SAFETY-IMG-028-20260129"
  },
  {
    id: "your vehicle and your safety 29",
    category: "Safety – Speed and Fuel Use",
    q: "How much more fuel will you use when driving at 70 mph compared with 50 mph?",
    choices: [
      "About 5%",
      "About 15%",
      "About 75%",
      "About 100%"
    ],
    correct: 1,
    explain: "At higher speeds the engine works harder. Driving at 70 mph uses around 15% more fuel than driving at 50 mph over the same distance.",
    image: "",
    fp: "R2D-SAFETY-IMG-029-20260129"
  },
  {
    id: "your vehicle and your safety 30",
    category: "Safety – Tyre Condition",
    q: "What would make your tyres illegal to use on the road?",
    choices: [
      "If they were bought second-hand",
      "If they have large or deep cuts in the sidewall",
      "If they are of different makes",
      "If they have different tread patterns"
    ],
    correct: 1,
    explain: "Tyres must be free from cuts, bulges and serious damage. Sidewall damage can cause tyre failure and is illegal.",
    image: "",
    fp: "R2D-SAFETY-IMG-030-20260129"
  },
  {
    id: "your vehicle and your safety 31",
    category: "Safety – Fuel Efficiency",
    q: "What is most likely to cause fuel to be wasted?",
    choices: [
      "Reducing your speed",
      "Driving on motorways",
      "Using different brands of fuel",
      "Under-inflated tyres"
    ],
    correct: 3,
    explain: "Under-inflated tyres increase rolling resistance, which makes the engine work harder and waste fuel.",
    image: "",
    fp: "R2D-SAFETY-IMG-031-20260129"
  },
  {
    id: "your vehicle and your safety 32",
    category: "Safety – Driver Assistance Systems",
    q: "You switch on adaptive cruise control while driving on a motorway. What are you still required to do?",
    choices: [
      "Remove your seat belt",
      "Eat and drink while driving",
      "Use your handheld mobile phone",
      "Continue checking the road and signs"
    ],
    correct: 3,
    explain: "ADAS features assist the driver but do not replace them. You must stay alert and continue to observe the road and traffic signs.",
    image: "",
    fp: "R2D-SAFETY-IMG-032-20260129"
  },
  {
    id: "your vehicle and your safety 33",
    category: "Safety – Environmental Responsibility",
    q: "You service your own vehicle. How should you dispose of old engine oil?",
    choices: [
      "Take it to a local-authority recycling site",
      "Pour it down a drain",
      "Tip it into a hole in the ground",
      "Put it in your household bin"
    ],
    correct: 0,
    explain: "Engine oil is a harmful pollutant and must be disposed of safely at an authorised recycling facility.",
    image: "",
    fp: "R2D-SAFETY-IMG-033-20260129"
  },
  {
    id: "your vehicle and your safety 34",
    category: "Safety – Driver Control",
    q: "Why is it important to wear suitable footwear when driving?",
    choices: [
      "To prevent wear on the pedals",
      "To maintain proper control of the pedals",
      "To allow you to adjust your seat",
      "To help you walk for assistance if you break down"
    ],
    correct: 1,
    explain: "Suitable footwear allows you to apply smooth and accurate pressure to the pedals, helping you stay in control of the vehicle.",
    image: "",
    fp: "R2D-SAFETY-IMG-034-20260129"
  },
  {
    id: "your vehicle and your safety 35",
    category: "Safety – Vehicle Technology",
    q: "You’re driving a car with blind-spot monitoring. What should you regularly check to ensure it works correctly?",
    choices: [
      "That the sensors on the car are clean",
      "That the tyres are correctly inflated",
      "That the dash cam is securely attached",
      "That the car has a GPS signal"
    ],
    correct: 0,
    explain: "Blind-spot monitoring relies on sensors. Dirt or debris can stop the system from detecting other vehicles properly.",
    image: "",
    fp: "R2D-SAFETY-IMG-035-20260129"
  },
  {
    id: "your vehicle and your safety 36",
    category: "Safety – Traffic Calming",
    q: "How should you drive along a road that has road humps?",
    choices: [
      "Maintain a reduced speed throughout",
      "Accelerate quickly between the humps",
      "Always drive at the maximum legal speed",
      "Slow down only at school times"
    ],
    correct: 0,
    explain: "Road humps are designed to keep vehicle speeds low throughout the area to protect vulnerable road users.",
    image: "",
    fp: "R2D-SAFETY-IMG-036-20260129"
  },
  {
    id: "your vehicle and your safety 37",
    category: "Safety – Warning Lights",
    q: "What does it mean if this warning light comes on while you are driving?",
    choices: [
      "The engine oil level is low",
      "A rear light has failed",
      "Your seat belt is not fastened",
      "There is a fault in the braking system"
    ],
    correct: 3,
    explain: "A brake warning light indicates a potential fault with the braking system. You should have it checked immediately.",
    image: "faultybrakesystem.PNG",
    fp: "R2D-SAFETY-IMG-037-20260129"
  },
  {
    id: "your vehicle and your safety 38",
    category: "Safety – Tyres",
    q: "What is the legal minimum tread depth for car tyres?",
    choices: [
      "1 mm",
      "1.6 mm",
      "2.5 mm",
      "4 mm"
    ],
    correct: 1,
    explain: "The legal minimum tread depth for cars is 1.6 mm across the central three-quarters of the tyre and around the entire circumference.",
    image: "",
    fp: "R2D-SAFETY-IMG-038-20260129"
  },
  {
    id: "your vehicle and your safety 39",
    category: "Safety – Vehicle Security",
    q: "How can you reduce the risk of your car radio being stolen?",
    choices: [
      "Park in an unlit area",
      "Leave the radio switched on",
      "Park near a busy junction",
      "Fit a security-coded radio"
    ],
    correct: 3,
    explain: "A security-coded radio is of little use once removed, which makes it less attractive to thieves.",
    image: "",
    fp: "R2D-SAFETY-IMG-039-20260129"
  },
  {
    id: "your vehicle and your safety 40",
    category: "Safety – Driver Assistance Systems",
    q: "This dashboard symbol appears while driving on a dual carriageway. Which driver assistance system is active?",
    choices: [
      "Blind-spot assist",
      "Intelligent speed assist",
      "Lane-keep assist",
      "Traffic jam assist"
    ],
    correct: 2,
    explain: "Lane-keep assist helps prevent the vehicle from drifting out of its lane by providing steering input or warnings.",
    image: "laneassist.PNG",
    fp: "R2D-SAFETY-IMG-040-20260129"
  },
  {
    id: "your vehicle and your safety 41",
    category: "Safety – Driver Assistance Systems",
    q: "You're driving along a quiet motorway. Which advanced driver assistance system is most likely to help you?",
    choices: [
      "Traffic jam assist",
      "Automotive night vision",
      "Intelligent speed assist",
      "Lane-departure warning"
    ],
    correct: 3,
    explain: "Lane-departure warning alerts you if you begin to drift out of your lane, which can help prevent collisions on quieter roads.",
    image: "",
    fp: "R2D-SAFETY-IMG-041-20260129"
  },
  {
    id: "your vehicle and your safety 42",
    category: "Safety – Driver Assistance Systems",
    q: "You're driving an unfamiliar car fitted with advanced driver assistance systems (ADAS). Where would you find information on how to use them correctly?",
    choices: [
      "Ask at your local garage",
      "In the manufacturer's handbook",
      "In the Highway Code",
      "Ask a motoring association"
    ],
    correct: 1,
    explain: "Manufacturers may use different names and systems. The vehicle handbook explains how the specific ADAS features work.",
    image: "",
    fp: "R2D-SAFETY-IMG-042-20260129"
  },
  {
    id: "your vehicle and your safety 43",
    category: "Safety – Environmental Driving",
    q: "How can you reduce the environmental harm caused by your vehicle?",
    choices: [
      "Only use it for short journeys",
      "Do not service it",
      "Drive faster than normal",
      "Keep engine revs low"
    ],
    correct: 3,
    explain: "Keeping engine revs low reduces fuel consumption and emissions, helping to reduce environmental harm.",
    image: "",
    fp: "R2D-SAFETY-IMG-043-20260129"
  },
  {
    id: "your vehicle and your safety 44",
    category: "Safety – Environmental Awareness",
    q: "What can people who live or work in towns and cities do to help reduce urban pollution?",
    choices: [
      "Drive more quickly",
      "Over-rev in a low gear",
      "Walk or cycle",
      "Drive short journeys"
    ],
    correct: 2,
    explain: "Walking or cycling produces no vehicle emissions and also provides health benefits.",
    image: "",
    fp: "R2D-SAFETY-IMG-044-20260129"
  },
  {
    id: "your vehicle and your safety 45",
    category: "Safety – Parking",
    q: "Where would parking your vehicle cause an obstruction?",
    choices: [
      "Alongside a parking meter",
      "In front of a property entrance",
      "On your driveway",
      "In a marked parking space"
    ],
    correct: 1,
    explain: "Parking in front of a property entrance can block access and is likely to cause an obstruction.",
    image: "",
    fp: "R2D-SAFETY-IMG-045-20260129"
  },
  {
    id: "your vehicle and your safety 46",
    category: "Safety – Vehicle Maintenance",
    q: "What will happen if your car's wheels are unbalanced?",
    choices: [
      "The steering will pull to one side",
      "The steering will vibrate",
      "The brakes will fail",
      "The tyres will deflate"
    ],
    correct: 1,
    explain: "Unbalanced wheels cause vibration through the steering wheel, especially at certain speeds.",
    image: "",
    fp: "R2D-SAFETY-IMG-046-20260129"
  },
  {
    id: "your vehicle and your safety 47",
    category: "Safety – Vehicle Checks",
    q: "What could cause you to crash if the level becomes too low?",
    choices: [
      "Anti-freeze level",
      "Brake-fluid level",
      "Battery-water level",
      "Radiator-coolant level"
    ],
    correct: 1,
    explain: "If brake-fluid levels drop too low, braking efficiency can be reduced or lost entirely.",
    image: "",
    fp: "R2D-SAFETY-IMG-047-20260129"
  },
  {
    id: "your vehicle and your safety 48",
    category: "Safety – Eco-Safe Driving",
    q: "What does fuel-efficient driving help to achieve?",
    choices: [
      "Increased fuel consumption",
      "Improved road safety",
      "Damage to the environment",
      "Increased exhaust emissions"
    ],
    correct: 1,
    explain: "Fuel-efficient driving encourages better hazard awareness and smoother driving, which improves road safety.",
    image: "",
    fp: "R2D-SAFETY-IMG-048-20260129"
  },
  {
    id: "your vehicle and your safety 49",
    category: "Safety – Driver Condition",
    q: "You're driving a car fitted with driver drowsiness detection. When will the system alert you to take a break?",
    choices: [
      "After driving for four hours without a break",
      "When sensors detect behaviour suggesting fatigue",
      "At pre-programmed times of day",
      "When you pass 'take a break' road signs"
    ],
    correct: 1,
    explain: "The system monitors driving behaviour and alerts you if signs of tiredness are detected.",
    image: "",
    fp: "R2D-SAFETY-IMG-049-20260129"
  },
  {
    id: "your vehicle and your safety 50",
    category: "Safety – Seat Belts and Child Safety",
    q: "You're carrying an 11-year-old child on the front seat who is under 1.35 metres tall. What restraint must be used?",
    choices: [
      "An adult seat belt",
      "The child fastening their own seat belt",
      "A suitable child restraint",
      "Clear view out of the front windscreen"
    ],
    correct: 2,
    explain: "Children under 1.35 metres must use a suitable child restraint, even when seated in the front.",
    image: "",
    fp: "R2D-SAFETY-IMG-050-20260129"
  },
  {
    id: "your vehicle and your safety 51",
    category: "Vehicle security",
    q: "What may help to deter a thief from stealing your car?",
    choices: [
      "Always keeping the headlights on",
      "Fitting reflective glass windows",
      "Always keeping the interior light on",
      "Etching the registration number on the windows"
    ],
    correct: 3,
    explain: "Having your car registration number etched on all your windows is a cheap and effective way to deter professional car thieves.",
    image: "",
    fp: "R2D-MC-0051-20260129"
  },
  {
    id: "your vehicle and your safety 52",
    category: "Eco-safe driving",
    q: "How can drivers help the environment?",
    choices: [
      "By accelerating harshly",
      "By accelerating gently",
      "By using leaded fuel",
      "By driving faster"
    ],
    correct: 1,
    explain: "Rapid acceleration and heavy braking increase fuel consumption and wear on your vehicle. Regular servicing helps maintain efficiency, produces cleaner emissions and reduces the risk of a breakdown.",
    image: "",
    fp: "R2D-MC-0052-20260129"
  },
  {
    id: "your vehicle and your safety 53",
    category: "Journey planning",
    q: "How will your journey be affected by travelling outside the busy times of day?",
    choices: [
      "Your journey will use more fuel",
      "Your journey will take longer",
      "Your journey will be more hazardous",
      "Your journey will have fewer delays"
    ],
    correct: 3,
    explain: "If possible, avoid the early morning, late afternoon and early evening rush hour. Doing this should allow you to have a better journey with fewer delays and arrive feeling less stressed.",
    image: "",
    fp: "R2D-MC-0053-20260129"
  },
  {
    id: "your vehicle and your safety 54",
    category: "Vehicle security",
    q: "How can you reduce the risk of your vehicle being broken into at night?",
    choices: [
      "Leave it in a well-lit area",
      "Park in a quiet side road",
      "Do not engage the steering lock",
      "Park in a poorly lit area"
    ],
    correct: 0,
    explain: "Avoid leaving your vehicle unattended in poorly lit areas, as this increases the risk of theft or break-ins.",
    image: "",
    fp: "R2D-MC-0054-20260129"
  },
  {
    id: "your vehicle and your safety 55",
    category: "Vehicle maintenance",
    q: "When should you check the engine oil level?",
    choices: [
      "Before a long journey",
      "When the engine is hot",
      "Early in the morning",
      "Every time you drive the car"
    ],
    correct: 0,
    explain: "An engine can use more oil during long journeys. Low oil levels can lead to excessive wear, breakdowns and expensive repairs.",
    image: "",
    fp: "R2D-MC-0055-20260129"
  },
  {
    id: "your vehicle and your safety 56",
    category: "Rules of the road",
    q: "When are you not allowed to sound your vehicle's horn?",
    choices: [
      "Between 10.00 pm and 6.00 am in a built-up area",
      "At any time in a built-up area",
      "Between 11.30 pm and 7.00 am in a built-up area",
      "Between 11.30 pm and 6.00 am on any road"
    ],
    correct: 2,
    explain: "It’s illegal to sound your horn in a built-up area between 11.30 pm and 7.00 am, except when another road user poses a danger.",
    image: "",
    fp: "R2D-MC-0056-20260129"
  },
  {
    id: "your vehicle and your safety 57",
    category: "Eco-safe driving",
    q: "How can you avoid wasting fuel?",
    choices: [
      "By having your vehicle serviced regularly",
      "By revving the engine in the lower gears",
      "By keeping an empty roof rack on your vehicle",
      "By driving at higher speeds where possible"
    ],
    correct: 0,
    explain: "Regular servicing keeps the engine running efficiently, reducing fuel consumption and harmful emissions.",
    image: "",
    fp: "R2D-MC-0057-20260129"
  },
  {
    id: "your vehicle and your safety 58",
    category: "Eco-safe driving",
    q: "Which driving technique can help you save fuel?",
    choices: [
      "Using lower gears as often as possible",
      "Accelerating sharply in each gear",
      "Using each gear in turn",
      "Missing out some gears"
    ],
    correct: 3,
    explain: "Missing out intermediate gears when appropriate reduces the time spent accelerating and decelerating, which saves fuel.",
    image: "",
    fp: "R2D-MC-0058-20260129"
  },
  {
    id: "your vehicle and your safety 59",
    category: "Vehicle maintenance",
    q: "When should tyre pressures be checked?",
    choices: [
      "After any lengthy journey",
      "After travelling at high speed",
      "When tyres are hot",
      "When tyres are cold"
    ],
    correct: 3,
    explain: "Tyre pressures should be checked when the tyres are cold, as heat increases pressure and gives an inaccurate reading.",
    image: "",
    fp: "R2D-MC-0059-20260129"
  },
  {
    id: "your vehicle and your safety 60",
    category: "Eco-safe driving",
    q: "What will reduce fuel consumption?",
    choices: [
      "Driving more slowly",
      "Accelerating rapidly",
      "Late and heavy braking",
      "Staying in lower gears"
    ],
    correct: 0,
    explain: "Smooth driving at a steady speed in an appropriate gear reduces fuel use. Anticipating hazards early also helps save fuel.",
    image: "",
    fp: "R2D-MC-0060-20260129"
  },
  {
    id: "your vehicle and your safety 61",
    category: "Vehicle safety – Tyres",
    q: "How would under-inflated tyres affect your vehicle?",
    choices: [
      "The vehicle's stopping distance would increase",
      "The flash rate of the vehicle's indicators would increase",
      "The vehicle's gear change mechanism would become stiff",
      "The vehicle's headlights would aim high"
    ],
    correct: 0,
    explain: "Your tyres are your only contact with the road. Under-inflated tyres reduce braking efficiency and steering control, increasing stopping distances and the risk of skidding. Correct tyre pressures help provide a safer and more comfortable drive.",
    image: "",
    fp: "R2D-SAFETY-0061-20260129"
  },
  {
    id: "your vehicle and your safety 62",
    category: "Vehicle security",
    q: "How can you reduce the chances of your car being broken into when leaving it unattended?",
    choices: [
      "Take all valuables with you",
      "Park near a taxi rank",
      "Place any valuables on the floor",
      "Park near a fire station"
    ],
    correct: 0,
    explain: "When leaving your car unattended, take all valuables with you if possible. If you can’t, lock them out of sight to reduce the risk of theft.",
    image: "",
    fp: "R2D-SAFETY-0062-20260129"
  },
  {
    id: "your vehicle and your safety 63",
    category: "Eco-safe driving",
    q: "How can driving in a fuel-efficient manner help protect the environment?",
    choices: [
      "Through the legal enforcement of speed regulations",
      "By increasing the number of cars on the road",
      "Through increased fuel bills",
      "By reducing exhaust emissions"
    ],
    correct: 3,
    explain: "Fuel-efficient driving involves planning further ahead and anticipating hazards. This reduces the need for harsh acceleration and braking, lowers fuel consumption, and cuts exhaust emissions that can damage the environment.",
    image: "",
    fp: "R2D-SAFETY-0063-20260129"
  },
  {
    id: "your vehicle and your safety 64",
    category: "Vehicle maintenance – Suspension",
    q: "What does it mean if your vehicle keeps bouncing after you sharply press down and release on the bodywork over a wheel?",
    choices: [
      "The tyres are worn",
      "The tyres are under inflated",
      "The vehicle is on soft ground",
      "The shock absorbers are worn"
    ],
    correct: 3,
    explain: "If the vehicle continues to bounce after being pressed down and released, the shock absorbers may be worn. Worn shock absorbers can reduce stability, especially when cornering, and should be checked by a qualified mechanic.",
    image: "",
    fp: "R2D-SAFETY-0064-20260129"
  },
  {
    id: "your vehicle and your safety 65",
    category: "Eco-safe driving",
    q: "What could you do to reduce the volume of traffic on the roads?",
    choices: [
      "Drive in a bus lane",
      "Use a car with a smaller engine",
      "Walk or cycle on short journeys",
      "Travel by car at all times"
    ],
    correct: 2,
    explain: "Avoid using your car as a matter of routine. For shorter journeys, walking or cycling can help reduce traffic levels and is better for both you and the environment.",
    image: "",
    fp: "R2D-SAFETY-0065-20260129"
  },
  {
    id: "your vehicle and your safety 66",
    category: "Vehicle use – Engine idling",
    q: "You're stopped at the side of the road. What must you do if you'll be waiting there for some time?",
    choices: [
      "Switch off the engine",
      "Apply the steering lock",
      "Switch off the radio",
      "Use your headlights"
    ],
    correct: 0,
    explain: "If your vehicle is stationary and likely to remain so for some time, you must switch off the engine unless you’re stationary in traffic or diagnosing a fault. This helps reduce emissions and unnecessary engine wear.",
    image: "",
    fp: "R2D-SAFETY-0066-20260129"
  },
  {
    id: "your vehicle and your safety 67",
    category: "Journey planning",
    q: "You plan your route before starting a journey. Why should you also plan an alternative route?",
    choices: [
      "Your original route may be blocked",
      "Your maps may have different scales",
      "You may find you have to pay a congestion charge",
      "You may get held up by a tractor"
    ],
    correct: 0,
    explain: "Roadworks, accidents or diversions can block your planned route. Having an alternative route helps reduce stress and allows you to concentrate fully on your driving. If your main route uses motorways, it’s sensible to plan a non-motorway alternative.",
    image: "",
    fp: "R2D-SAFETY-0067-20260129"
  },
  {
    id: "your vehicle and your safety 68",
    category: "Vehicle security",
    q: "What's the safest thing to do if you have to leave valuables in your car?",
    choices: [
      "Put them in a carrier bag",
      "Park near a school entrance",
      "Lock them out of sight",
      "Park near a bus stop"
    ],
    correct: 2,
    explain: "If you must leave valuables in your car, lock them out of sight. This helps deter opportunist thieves and reduces the risk of a break-in.",
    image: "",
    fp: "R2D-SAFETY-0068-20260129"
  },
  {
    id: "your vehicle and your safety 69",
    category: "Eco-safe driving",
    q: "What's most likely to increase fuel consumption?",
    choices: [
      "Poor steering control",
      "Accelerating around bends",
      "Staying in high gears",
      "Harsh braking and accelerating"
    ],
    correct: 3,
    explain: "Harsh braking and rapid acceleration use more fuel and increase wear on your vehicle. Driving smoothly helps reduce fuel consumption and is better for the environment.",
    image: "",
    fp: "R2D-SAFETY-0069-20260129"
  },
  {
    id: "your vehicle and your safety 70",
    category: "Vehicle security",
    q: "What should you remove from your car before leaving it unattended?",
    choices: [
      "The car dealer's details",
      "The owner's manual",
      "The service record",
      "The vehicle registration document"
    ],
    correct: 3,
    explain: "Never leave the vehicle registration document in your car. It could help a thief to dispose of the vehicle more easily if it’s stolen.",
    image: "",
    fp: "R2D-SAFETY-0070-20260129"
  },
  {
    id: "your vehicle and your safety 71",
    category: "Journey planning",
    q: "How can you plan your route before starting a long journey?",
    choices: [
      "Check your vehicle handbook",
      "Ask your local garage",
      "Use a route planner on the internet",
      "Consult a travel agent"
    ],
    correct: 2,
    explain: "Online route planners can offer several route options, including direct and quieter roads. They may also highlight rest stops and fuel stations. Printing the directions can be useful in case you lose signal.",
    image: "",
    fp: "R2D-SAFETY-0071-20260129"
  },
  {
    id: "your vehicle and your safety 72",
    category: "Journey planning",
    q: "Why is it a good idea to plan your journey to avoid busy times?",
    choices: [
      "You'll have an easier journey",
      "You'll have a more stressful journey",
      "Your journey time will be longer",
      "It will cause more traffic congestion"
    ],
    correct: 0,
    explain: "Avoiding busy times, such as school or work travel periods, can reduce delays and stress, helping to make your journey easier and more enjoyable.",
    image: "",
    fp: "R2D-SAFETY-0072-20260129"
  },
  {
    id: "your vehicle and your safety 73",
    category: "Vehicle lighting – Parking",
    q: "You're parked on the road at night. When must you use parking lights?",
    choices: [
      "When there are continuous white lines in the middle of the road",
      "When the speed limit exceeds 30 mph",
      "When you're facing oncoming traffic",
      "When you're near a bus stop"
    ],
    correct: 1,
    explain: "When parking at night on a road with a speed limit over 30 mph, you must use your parking lights. You should also park in the direction of traffic so other road users can see the rear reflectors of your vehicle.",
    image: "",
    fp: "R2D-SAFETY-0073-20260129"
  },
  {
    id: "your vehicle and your safety 74",
    category: "Seat belts and restraints",
    q: "When may a passenger travel in a car without wearing a seat belt?",
    choices: [
      "When they're under 14 years old",
      "When they're under 1.5 metres (5 feet) in height",
      "When they're sitting in the rear seat",
      "When they're exempt for medical reasons"
    ],
    correct: 3,
    explain: "Passengers may only travel without wearing a seat belt if they have a valid medical exemption certificate. Drivers are responsible for ensuring children are correctly restrained and should remind adult passengers to wear seat belts.",
    image: "",
    fp: "R2D-SAFETY-0074-20260129"
  },
  {
    id: "your vehicle and your safety 75",
    category: "Vehicle maintenance – Brakes",
    q: "What should you do if your vehicle pulls to one side when you use the brakes?",
    choices: [
      "Increase the pressure in your tyres",
      "Have the brakes checked as soon as possible",
      "Change gear and pump the brake pedal",
      "Use your parking brake at the same time"
    ],
    correct: 1,
    explain: "If your vehicle pulls to one side when braking, it may indicate a fault with the braking system. You should have the brakes checked by a qualified mechanic as soon as possible.",
    image: "",
    fp: "R2D-SAFETY-0075-20260129"
  },
  {
    id: "your vehicle and your safety 76",
    category: "Eco-safe driving",
    q: "What can you expect if you drive using rapid acceleration and heavy braking?",
    choices: [
      "Reduced pollution",
      "Increased fuel consumption",
      "Reduced exhaust emissions",
      "Increased road safety"
    ],
    correct: 1,
    explain: "Rapid acceleration and heavy braking increase fuel consumption and wear on your vehicle. Using the controls smoothly and planning ahead can reduce fuel use by around 15% and lower wear and tear.",
    image: "",
    fp: "R2D-SAFETY-0076-20260129"
  },
  {
    id: "your vehicle and your safety 77",
    category: "Vehicle use – Engine idling",
    q: "You're leaving your vehicle parked on a road and unattended. When may you leave the engine running?",
    choices: [
      "If you'll be parking for less than five minutes",
      "If the battery keeps going flat",
      "When parked in a 20 mph zone",
      "Never if you're away from the vehicle"
    ],
    correct: 3,
    explain: "When leaving your vehicle parked and unattended, you must switch off the engine and secure the vehicle. Ensure all windows are closed, the vehicle is locked, valuables are out of sight, and the alarm is set if fitted.",
    image: "",
    fp: "R2D-SAFETY-0077-20260129"
  },
  {
    id: "your vehicle and your safety 78",
    category: "Vehicle security",
    q: "What should you do when you leave your car unattended for a few minutes?",
    choices: [
      "Leave the engine running",
      "Switch the engine off but leave the key in",
      "Lock it and remove the key",
      "Park near a traffic warden"
    ],
    correct: 2,
    explain: "You should always switch off the engine, remove the key, and lock your car, even if you're only leaving it unattended for a short time.",
    image: "",
    fp: "R2D-SAFETY-0078-20260129"
  },
  {
    id: "your vehicle and your safety 79",
    category: "Driver assistance systems",
    q: "Which advanced driver assistance system is designed to actively prevent collisions?",
    choices: [
      "Automotive night vision",
      "Driver drowsiness detection",
      "Advanced emergency braking system",
      "Cruise control"
    ],
    correct: 2,
    explain: "Advanced emergency braking systems use sensors to detect hazards ahead. If the system determines that a collision is likely and the driver isn’t reacting, it will automatically apply the brakes to help prevent or reduce the severity of a collision.",
    image: "",
    fp: "R2D-SAFETY-0079-20260129"
  },
  {
    id: "your vehicle and your safety 80",
    category: "Environmental safety",
    q: "How should you dispose of a used vehicle battery?",
    choices: [
      "Bury it in your garden",
      "Put it in the dustbin",
      "Take it to a local-authority disposal site",
      "Leave it on waste land"
    ],
    correct: 2,
    explain: "Vehicle batteries contain hazardous acid and must be disposed of safely. They should be taken to an appropriate local-authority recycling or disposal site.",
    image: "",
    fp: "R2D-SAFETY-0080-20260129"
  },
  {
    id: "your vehicle and your safety 81",
    category: "Vehicle maintenance – Tyres",
    q: "What's the legal minimum tread depth for tyres on your trailer or caravan?",
    choices: [
      "1 mm",
      "1.6 mm",
      "2 mm",
      "2.6 mm"
    ],
    correct: 1,
    explain: "The legal minimum tread depth for trailer and caravan tyres is 1.6 mm across the central three-quarters of the tyre’s width and around the entire circumference. Tyres can deteriorate while in storage, so their condition and pressures should be checked regularly.",
    image: "",
    fp: "R2D-SAFETY-0081-20260129"
  },
  {
    id: "your vehicle and your safety 82",
    category: "Environmental safety",
    q: "What can you do to reduce environmental damage caused by your vehicle?",
    choices: [
      "Avoid using the cruise control",
      "Use the air conditioning whenever you drive",
      "Use the gears to slow the vehicle",
      "Avoid making a lot of short journeys"
    ],
    correct: 3,
    explain: "Avoid using your car for short journeys where possible. On short trips the engine may not warm up fully, causing it to run less efficiently and produce higher levels of harmful emissions.",
    image: "",
    fp: "R2D-SAFETY-0082-20260129"
  }
];

const el = (id) => document.getElementById(id);
const appScroll = document.getElementById("appScroll");
const startScreen = el("startScreen");
const quizScreen = el("quizScreen");
const resultsScreen = el("resultsScreen");
const reviewScreen = el("reviewScreen");

const startBtn = el("startBtn");
const shuffleBtn = el("shuffleBtn");
const resetBestBtn = el("resetBestBtn");
const bestScore = el("bestScore");
const lastScore = el("lastScore");

const catTag = el("catTag");
const counter = el("counter");
const qText = el("qText");
const answers = el("answers");
const feedback = el("feedback");
const submitBtn = el("submitBtn");
const backBtn = el("backBtn");
const quitBtn = el("quitBtn");

const quitConfirm = el("quitConfirm");
const quitYesBtn = el("quitYesBtn");
const quitNoBtn  = el("quitNoBtn");
const resumeModal = el("resumeModal");
const resumeBtn = el("resumeBtn");
const resumeFreshBtn = el("resumeFreshBtn");
const resumeInfo = el("resumeInfo");

const bar = el("bar");
const scoreMini = el("scoreMini");
scoreMini.style.display = "none";

const qImg = el("qImage");
const imgHint = el("imgHint");
const zoomOverlay = el("zoomOverlay");
const zoomImg = el("zoomImg");

const resultTitle = el("resultTitle");
const resultSub = el("resultSub");
const finalScore = el("finalScore");
const finalPercent = el("finalPercent");
const finalTime = el("finalTime");

const retryBtn = el("retryBtn");
const reviewBtn = el("reviewBtn");

const reviewList = el("reviewList");
const reviewFilter = el("reviewFilter");
const reviewCount = el("reviewCount");
const backToResultsBtn = el("backToResultsBtn");
const newAttemptBtn = el("newAttemptBtn");


// =========================================================
// NOTE (R2D): Local storage keys (scores + resume)
// These depend on TEST_SLUG. If you duplicate this file, update TEST_SLUG.
// =========================================================
const STORAGE_BEST = `r2d_${TEST_SLUG}_best`;
const STORAGE_ATTEMPT = `r2d_${TEST_SLUG}_attempt_v1`;

const STORAGE_LAST_REVIEW = `r2d_${TEST_SLUG}_last_review`;
const STORAGE_QS = `r2d_${TEST_SLUG}_qs`;

// =========================================================
// R2D PRACTICE DASHBOARD STATS + MASTERY (TEMPLATE)
// ---------------------------------------------------------
// This writes progress into localStorage so your Practice page can show:
// - Best / Last / Attempts (%)
// - Mastered (unique questions ever answered correctly)
// Keys are derived from TEST_SLUG (keep TEST_SLUG unique per test).
// =========================================================
const R2D_PRACTICE_STATS_KEY        = `r2d_${TEST_SLUG.replace(/-/g,"_")}`;  // e.g. r2d_staying_alert                 // e.g. r2d_staying_alert
const R2D_MASTERY_STATS_KEY         = `r2d_${TEST_SLUG}_mastery_stats_v1`;  // e.g. r2d_staying-alert_mastery_stats_v1 // e.g. r2d_staying-alert_mastery_stats_v1
const R2D_MASTERY_MAP_KEY           = `r2d_${TEST_SLUG}_mastery_map_v1`;    // e.g. r2d_staying-alert_mastery_map_v1   // e.g. r2d_staying-alert_mastery_map_v1

function r2dSavePracticeStats(storageKey, score, total){
  try{
    const existing = JSON.parse(localStorage.getItem(storageKey)) || { best: "0%", attempts: 0 };
    const percent = Math.round((score / total) * 100);

    const bestNum = parseInt(String(existing.best || "0").replace("%",""), 10);
    const safeBest = Number.isFinite(bestNum) ? bestNum : 0;

    const updated = {
      last: percent + "%",
      best: Math.max(safeBest, percent) + "%",
      attempts: (existing.attempts || 0) + 1
    };

    localStorage.setItem(storageKey, JSON.stringify(updated));
  }catch(e){}
}

function r2dLoadMasteryMap(mapKey){
  try{
    const raw = localStorage.getItem(mapKey);
    const obj = raw ? JSON.parse(raw) : {};
    return (obj && typeof obj === "object") ? obj : {};
  }catch{
    return {};
  }
}

function r2dSaveMasteryFromAttempt(){
  // Mark any correctly-answered questions as "mastered"
  const map = r2dLoadMasteryMap(R2D_MASTERY_MAP_KEY);

  for (let i = 0; i < attempt.length; i++){
    const p = picked[i];
    if (!p) continue;
    if (p.choiceIndex === attempt[i].correct){
      const qid = attempt[i].id;
      if (qid) map[qid] = true;
    }
  }

  // Count mastered across the FULL bank (not just this attempt)
  const total = QUESTION_BANK.length;
  let mastered = 0;
  for (const q of QUESTION_BANK){
    if (q && q.id && map[q.id]) mastered++;
  }

  localStorage.setItem(R2D_MASTERY_MAP_KEY, JSON.stringify(map));
  localStorage.setItem(R2D_MASTERY_STATS_KEY, JSON.stringify({
    mastered,
    total,
    updatedAt: Date.now()
  }));
}


function saveLastReview(){
  try{
    localStorage.setItem(STORAGE_LAST_REVIEW, JSON.stringify({
      savedAt: Date.now(),
      attempt,
      picked
    }));
  }catch(e){}
}

function loadLastReview(){
  try{
    const raw = localStorage.getItem(STORAGE_LAST_REVIEW);
    if (!raw) return null;
    const s = JSON.parse(raw);
    if (!s || !Array.isArray(s.attempt) || !Array.isArray(s.picked)) return null;
    return s;
  }catch{
    return null;
  }
}

function showLastReviewButton(){
  const wrap = document.getElementById("reviewLastWrap");
  const meta = document.getElementById("reviewLastMeta");
  const btn  = document.getElementById("reviewLastBtn");
  if (!wrap || !btn) return;

  const s = loadLastReview();
  if (!s){
    wrap.style.display = "none";
    return;
  }

  if (meta) meta.textContent = new Date(s.savedAt).toLocaleString();
  wrap.style.display = "block";

  btn.onclick = () => {
    attempt = s.attempt;
    picked  = s.picked;
    buildReview("all");
    show(reviewScreen);
  };
}

let attempt = [];
let idx = 0;
let score = 0;
let picked = [];
let currentSelected = null;
let startedAt = null;
let qsPerAttempt = QS_PER_ATTEMPT_DEFAULT;

let submitMode = 'submit'; // 'submit' or 'next'


function setSubmitButton(mode){
  submitMode = mode;
  if (mode === 'submit'){
    submitBtn.textContent = 'Submit';
    submitBtn.classList.add('primary');
    submitBtn.classList.remove('next-state');
  } else {
    submitBtn.textContent = 'Next';
    submitBtn.classList.remove('primary');
    submitBtn.classList.add('next-state');
  }
}


function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[s]));
}
function shuffle(arr){
  const a = arr.slice();
  for (let i=a.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function saveAttempt(){
  try{
    const state = {
      v: 1,
      savedAt: Date.now(),
      idx,
      score,
      picked,
      attempt,
      startedAt: startedAt ? new Date(startedAt).toISOString() : null
    };
    localStorage.setItem(STORAGE_ATTEMPT, JSON.stringify(state));
  }catch(e){
    console.warn("Could not save attempt", e);
  }
}

function loadAttempt(){
  try{
    const raw = localStorage.getItem(STORAGE_ATTEMPT);
    if (!raw) return null;
    const state = JSON.parse(raw);
    if (!state || state.v !== 1) return null;
    return state;
  }catch{
    return null;
  }
}

function clearAttempt(){
  localStorage.removeItem(STORAGE_ATTEMPT);
}

function checkForResume(){
  const state = loadAttempt();
  if (!state || !Array.isArray(state.attempt) || typeof state.idx !== "number") return false;
  if (state.idx < 0 || state.idx >= state.attempt.length) return false;

  // If it's basically a fresh attempt with no answers, only prompt if they've actually started
  const hasProgress = Array.isArray(state.picked) && state.picked.some(p => p !== null && p !== undefined);
  if (!hasProgress) return false;

  const minsAgo = Math.max(0, Math.round((Date.now() - (state.savedAt || Date.now())) / 60000));
  if (resumeInfo){
    resumeInfo.textContent = `You were on question ${state.idx + 1}. Saved ${minsAgo === 0 ? "just now" : minsAgo + " min ago"}.`;
  }
  if (resumeModal) resumeModal.style.display = "flex";
  return true;
}

if (resumeBtn){
  resumeBtn.addEventListener("click", () => {
    const state = loadAttempt();
    if (!state) return;
    // restore state
    attempt = state.attempt;
    idx = state.idx;
    score = state.score || 0;
    picked = Array.isArray(state.picked) ? state.picked : Array(attempt.length).fill(null);
    startedAt = state.startedAt ? new Date(state.startedAt) : new Date();

    if (resumeModal) resumeModal.style.display = "none";
    show(quizScreen);
    render();
  });
}

if (resumeFreshBtn){
  resumeFreshBtn.addEventListener("click", () => {
    clearAttempt();
    if (resumeModal) resumeModal.style.display = "none";
    loadStats();
    buildAttempt();
    show(quizScreen);
    render();
  });
}

// Tap outside the box closes (does not clear anything)
if (resumeModal){
  resumeModal.addEventListener("click", (e) => {
    if (e.target === resumeModal) resumeModal.style.display = "none";
  });
}
function show(screen){
  startScreen.style.display="none";
  quizScreen.style.display="none";
  resultsScreen.style.display="none";
  reviewScreen.style.display="none";
  screen.style.display="block";
  if (appScroll) appScroll.scrollTo({top:0, behavior:"smooth"});
}
function loadStats(){
  // Load saved question count (or default) and clamp to bank size
  const saved = localStorage.getItem(STORAGE_QS);
  let desired = saved ? Number(saved) : QS_PER_ATTEMPT_DEFAULT;
  if (!Number.isFinite(desired) || desired < 1) desired = QS_PER_ATTEMPT_DEFAULT;

  qsPerAttempt = Math.min(desired, QUESTION_BANK.length);

  const best = Number(localStorage.getItem(STORAGE_BEST) || 0);
  const last = Number(localStorage.getItem(`r2d_${TEST_SLUG}_last`) || 0);

  bestScore.textContent = best ? `${best} / ${qsPerAttempt}` : "—";
  lastScore.textContent = last ? `${last} / ${qsPerAttempt}` : "—";

  // Sync dropdown UI (start screen)
  const qsSelect = document.getElementById("qsSelect");
  const qsHint   = document.getElementById("qsHint");
  if (qsSelect){
    const full = QUESTION_BANK.length;
    const fullOpt = qsSelect.querySelector('option[value="full"]');
    if (fullOpt) fullOpt.textContent = `Full (${full})`;
    qsSelect.value = (qsPerAttempt === full) ? "full" : String(qsPerAttempt);
  }
  if (qsHint){
    qsHint.textContent = `(${qsPerAttempt} per attempt)`;
  }
}

function buildAttempt(){
  qsPerAttempt = Math.min(qsPerAttempt, QUESTION_BANK.length);
  const pool = shuffle(QUESTION_BANK);
  const selected = pool.slice(0, qsPerAttempt).map(q => {
    const mapped = q.choices.map((text, i) => ({text, originalIndex:i}));
    const shuffled = shuffle(mapped);
    const newCorrect = shuffled.findIndex(x => x.originalIndex === q.correct);
    return {...q, choices: shuffled.map(x => x.text), correct: newCorrect};
  });

  attempt = selected;
  idx = 0;
  score = 0;
  picked = Array(attempt.length).fill(null);
  startedAt = new Date();
  saveAttempt();
}
function setImage(src, isLarge, isXLarge){
  // reset sizing class each time
  qImg.className = "q-image" + (isLarge ? " large" : "") + (isXLarge ? " xlarge" : "");
  if (!src){
    qImg.style.display = "none";
    imgHint.style.display = "none";
    qImg.removeAttribute("src");
    return;
  }
  qImg.style.display = "block";
  imgHint.style.display = "block";
  qImg.src = src;
}


qImg.addEventListener("click", () => {
  if (!qImg.getAttribute("src")) return;
  zoomImg.src = qImg.src;
  zoomOverlay.style.display = "flex";
  zoomOverlay.setAttribute("aria-hidden","false");
});
zoomOverlay.addEventListener("click", () => {
  zoomOverlay.style.display = "none";
  zoomOverlay.setAttribute("aria-hidden","true");
  zoomImg.removeAttribute("src");
});

function render(){
  const q = attempt[idx];
  catTag.textContent = q.category || "Category";
  counter.textContent = `Question ${idx+1}`;
  qText.textContent = q.q;

  // Hide running score so users don't know results until the end
  scoreMini.textContent = "";

  // Progress shows where you are in the quiz (not your score)
  bar.style.width = `${Math.round((idx/attempt.length)*100)}%`;

  const isLarge = !!(q.largeImage ?? q.largeimage);
  const isXLarge = !!(q.extraLargeImage ?? q.extraLargeimage ?? q.xlargeImage ?? q.xlargeimage);
  setImage(q.image, isLarge, isXLarge);

  answers.innerHTML = "";
  feedback.style.display = "none"; // no per-question feedback
  feedback.className = "feedback";

  currentSelected = null;
  setSubmitButton('submit');
  submitBtn.disabled = true;

  q.choices.forEach((choiceText, i) => {
    const b = document.createElement("button");
    b.type = "button";
    b.className = "option";
    b.textContent = choiceText;
    b.addEventListener("click", () => selectOption(i));
    answers.appendChild(b);
  });

  // If this question was already submitted (e.g. user pressed Back), show it locked
  if (picked[idx] !== null && picked[idx] !== undefined){
    const chosen = picked[idx].choiceIndex;
    lockSubmitted(chosen);
    setSubmitButton('next');
    submitBtn.disabled = false;
    bar.style.width = `${Math.round(((idx+1)/attempt.length)*100)}%`;
  }
}

function selectOption(selectedIndex){
  // allow changing mind until submitted
  if (picked[idx] !== null && picked[idx] !== undefined) return;

  currentSelected = selectedIndex;
  submitBtn.disabled = false;

  [...answers.querySelectorAll("button.option")].forEach((btn, i) => {
    btn.classList.toggle("selected", i === selectedIndex);
  });
}

function lockSubmitted(selectedIndex){
  [...answers.querySelectorAll("button.option")].forEach((btn, i) => {
    btn.disabled = true;
    btn.classList.toggle("selected", i === selectedIndex);
  });
}

function submitCurrent(){
  if (currentSelected === null) return;

  // lock in answer for this question
  picked[idx] = { choiceIndex: currentSelected };

  lockSubmitted(currentSelected);
  setSubmitButton('next');
  submitBtn.disabled = false;
  bar.style.width = `${Math.round(((idx+1)/attempt.length)*100)}%`;
  saveAttempt();
}

function finish(){
  const total = attempt.length;

  // Calculate score only at the end (no feedback during the quiz)
  score = picked.reduce((s, p, i) => {
    if (!p) return s;
    return s + (p.choiceIndex === attempt[i].correct ? 1 : 0);
  }, 0);

  const pct = Math.round((score/total)*100);
  const elapsedMs = new Date() - startedAt;
  const mins = Math.floor(elapsedMs/60000);
  const secs = Math.floor((elapsedMs%60000)/1000);
  const timeStr = `${mins}m ${secs}s`;

  finalScore.textContent = `${score} / ${total}`;
  finalPercent.textContent = `${pct}%`;
  finalTime.textContent = timeStr;

  let title, sub;
  if (pct >= 90){
    title = "Excellent knowledge 💪";
    sub = "Keep it sharp by practising in real situations and revisiting any tricky areas.";
  } else if (pct >= 70){
    title = "Good work — a few gaps to tighten up ✅";
    sub = "Review the questions you missed and focus on the rules that caught you out.";
  } else if (pct >= 50){
    title = "Not bad — let’s build consistency 🔁";
    sub = "Slow down, read each question carefully, and learn the patterns behind the correct answers.";
  } else {
    title = "Let’s nail the foundations 🧱";
    sub = "Use the review explanations, then try again. Consistency beats guessing.";
  }
  resultTitle.textContent = title;
  resultSub.textContent = sub;

localStorage.setItem(`r2d_${TEST_SLUG}_last`, String(score));
  
  const best = Number(localStorage.getItem(STORAGE_BEST) || 0);
  if (score > best){
    localStorage.setItem(STORAGE_BEST, String(score));
  }

  // ---- Practice dashboard stats + mastery ----
  try{
    r2dSavePracticeStats(R2D_PRACTICE_STATS_KEY, score, total);
    r2dSaveMasteryFromAttempt();
  }catch(e){
    console.warn("R2D practice tracking failed", e);
  }

  loadStats();

  saveLastReview();

  clearAttempt();

    show(resultsScreen);
}

function buildReview(filter = 'all'){
  reviewList.innerHTML = "";
  let shown = 0;

  attempt.forEach((q, i) => {
    const p = picked[i];
    const you = p ? q.choices[p.choiceIndex] : "—";
    const correct = q.choices[q.correct];
    const ok = p ? (p.choiceIndex === q.correct) : false;

    if (filter === "wrong" && ok) return;

    shown += 1;

    const div = document.createElement("div");
    div.className = "reviewItem";
    div.innerHTML = `
      <div class="row">
        <div>
          <strong>${escapeHtml(q.q)}</strong>
        </div>
        <div class="result ${ok ? "ok" : "bad"}">${ok ? "✓" : "✕"}</div>
      </div>
      ${q.image ? `<img class="q-image review-image${q.largeImage ? " large" : ""}${q.extraLargeImage ? " xlarge" : ""}" alt="Question visual" src="${escapeHtml(q.image)}">` : ""}
      <div class="small" style="margin-top:8px">
        <div><span class="muted">You chose:</span> <strong>${escapeHtml(you)}</strong></div>
        <div><span class="muted">Correct:</span> <strong>${escapeHtml(correct)}</strong></div>
      </div>
      <div class="hint">${escapeHtml(q.explain || "")}</div>
    `;
    reviewList.appendChild(div);
  });

  if (reviewCount) reviewCount.textContent = `${shown} shown`;
}

startBtn.addEventListener("click", () => {
  loadStats();
  if (checkForResume()) return;
  buildAttempt();
  show(quizScreen);
  render();
});
resetBestBtn.addEventListener("click", () => {
  localStorage.removeItem(STORAGE_BEST);
  loadStats();
});


function goNext(){
  // must submit before moving on
  if (!picked[idx]) return;

  if (idx < attempt.length - 1){
    idx += 1;
    saveAttempt();
    render();
  } else {
    finish();
  }
}

submitBtn.addEventListener("click", () => {
  if (submitMode === "submit"){
    submitCurrent();
  } else {
    goNext();
  }
});

backBtn.addEventListener("click", () => {
  if (idx > 0){
    idx -= 1;
    render();
  } else {
    show(startScreen);
    showLastReviewButton();
  }
});
quitBtn.addEventListener("click", () => {
  if (!quitConfirm) { show(startScreen); showLastReviewButton(); return; }
  quitConfirm.style.display = "flex";
});

if (quitNoBtn){
  quitNoBtn.addEventListener("click", () => {
    quitConfirm.style.display = "none";
  });
}

if (quitYesBtn){
  quitYesBtn.addEventListener("click", () => {
    quitConfirm.style.display = "none";
    clearAttempt();
    window.location.href = "https://reddi2drive.co.uk/practice/";
  });
}

// Tap outside the box closes (same as "No")
if (quitConfirm){
  quitConfirm.addEventListener("click", (e) => {
    if (e.target === quitConfirm) quitConfirm.style.display = "none";
  });
}

retryBtn.addEventListener("click", () => {
  buildAttempt();
  show(quizScreen);
  render();
});
reviewBtn.addEventListener("click", () => {
  const f = reviewFilter ? reviewFilter.value : "all";
  buildReview(f);
  show(reviewScreen);
});

if (reviewFilter){
  reviewFilter.addEventListener("change", () => buildReview(reviewFilter.value));
}
backToResultsBtn.addEventListener("click", () => show(resultsScreen));
newAttemptBtn.addEventListener("click", () => {
  buildAttempt();
  show(quizScreen);
  render();
});

// =========================================================
// 2) UI TITLE (AUTO)
// ---------------------------------------------------------
// Keeps the page header title in sync with TEST_TITLE.
// =========================================================
const titleEl = document.getElementById("testTitleText");
if (titleEl) titleEl.textContent = TEST_TITLE;

loadStats();
show(startScreen);
showLastReviewButton();
checkForResume();

(() => {
  const scroller = document.getElementById("appScroll");
  if (!scroller) return;

  let startY = 0;

  scroller.addEventListener("touchstart", (e) => {
    startY = e.touches[0].clientY;
  }, { passive: true });

  scroller.addEventListener("touchmove", (e) => {
    const y = e.touches[0].clientY;
    const pullingDown = y > startY;

    if (scroller.scrollTop <= 0 && pullingDown) {
      e.preventDefault();
    }
  }, { passive: false });
})();

  // --- Fix iPad landscape viewport + prevent pull-to-refresh reliably ---
(() => {
  const scroller = document.getElementById("appScroll");
  if (!scroller) return;

  function setScrollerHeight(){
    const h = (window.visualViewport && window.visualViewport.height)
      ? Math.round(window.visualViewport.height)
      : window.innerHeight;
    scroller.style.height = h + "px";
  }

  setScrollerHeight();
  window.addEventListener("resize", setScrollerHeight);
  if (window.visualViewport) window.visualViewport.addEventListener("resize", setScrollerHeight);

  let startY = 0;
  scroller.addEventListener("touchstart", (e) => {
    startY = e.touches[0].clientY;
  }, { passive: true });

  scroller.addEventListener("touchmove", (e) => {
    const y = e.touches[0].clientY;
    const pullingDown = y > startY;
    if (scroller.scrollTop <= 0 && pullingDown) e.preventDefault();
  }, { passive: false });
})();


// --- Question count dropdown wiring (Start screen) ---
(function(){
  const qsSelect = document.getElementById("qsSelect");
  const qsHint   = document.getElementById("qsHint");
  if (!qsSelect) return;

  const full = QUESTION_BANK.length;

  const fullOpt = qsSelect.querySelector('option[value="full"]');
  if (fullOpt) fullOpt.textContent = `Full (${full})`;

  // Initialise from storage/default (loadStats also does this, but we keep it robust)
  const saved = localStorage.getItem(STORAGE_QS);
  let desired = saved ? Number(saved) : QS_PER_ATTEMPT_DEFAULT;
  if (!Number.isFinite(desired) || desired < 1) desired = QS_PER_ATTEMPT_DEFAULT;

  qsPerAttempt = Math.min(desired, full);
  qsSelect.value = (qsPerAttempt === full) ? "full" : String(qsPerAttempt);
  if (qsHint) qsHint.textContent = `(${qsPerAttempt} per attempt)`;

  qsSelect.addEventListener("change", () => {
    const v = (qsSelect.value === "full") ? full : Number(qsSelect.value);
    if (!Number.isFinite(v)) return;
    qsPerAttempt = Math.min(v, full);
    localStorage.setItem(STORAGE_QS, String(qsPerAttempt));
    if (qsHint) qsHint.textContent = `(${qsPerAttempt} per attempt)`;
    if (typeof loadStats === "function") loadStats();
  });
})();

// --- Hide question selector once the test starts; show it again for new attempts ---
(function(){
  const qsWrap = document.getElementById("qsWrapper");
  if (!qsWrap) return;

  const startBtn = document.getElementById("startBtn");
  const retryBtn = document.getElementById("retryBtn");
  const newAttemptBtn = document.getElementById("newAttemptBtn");

  function hideQS(){ qsWrap.style.display = "none"; }
  function showQS(){ qsWrap.style.display = "flex"; }

  if (startBtn) startBtn.addEventListener("click", hideQS);
  if (retryBtn) retryBtn.addEventListener("click", showQS);
  if (newAttemptBtn) newAttemptBtn.addEventListener("click", showQS);
})();
</script>
  </div>
</body>
</html>
